{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///x-bubbles.min.js","webpack:///webpack/bootstrap d99263f7c13e02004ec3","webpack:///./index.js","webpack:///./bubble.js","webpack:///./zws.js","webpack:///./events.js","webpack:///./events/backSpace.js","webpack:///./cursor.js","webpack:///./events/paste.js"],"names":["root","factory","exports","module","define","amd","this","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","onKeydown","event","set","currentTarget","code","charCode","keyCode","preventDefault","events","backSpace","bubble","isBubbleNode","target","focus","onKeypress","bubbling","cursor","restore","onDrop","onPaste","paste","onBlur","onFocus","XBubbles","Object","create","HTMLElement","prototype","createdCallback","value","setAttribute","attachedCallback","addEventListener","detachedCallback","removeEventListener","attributeChangedCallback","document","registerElement","extends","node","nodeType","Node","ELEMENT_NODE","classList","contains","options","begining","REG_BEGINING","ending","REG_ENDING","separator","REG_SEPARATOR","onBubble","NOOP","ranges","getBubbleRanges","nodes","forEach","range","text","zws","textClean","toString","trim","deleteContents","textParts","split","map","trimIterator","filter","nonEmptyIterator","reduce","parts","str","concat","parseFragmentByEnding","parseFragmentByBeginning","length","fragment","createDocumentFragment","textPart","wrap","createElement","innerText","add","appendChild","push","insertNode","i","rng","children","childNodes","setEndBefore","undefined","createRange","setStartBefore","setEndAfter","Boolean","reg","lastIndex","loop","exec","substring","res","index","_extends","assign","arguments","source","key","hasOwnProperty","REG_REPLACE_NON_PRINTABLE","REG_ZWS","TEXT_ZWS","String","replace","check","test","createTextNode","sel","window","getSelection","isCollapsed","rangeCount","setStartOffset","getRangeAt","removeAllRanges","addRange","startRange","startContainer","startOffset","hasZeroWidthSpace","deleteFromDocument","fakeText","collapse","setAfter","setBefore","setStartAfter","TEXT_NODE","nodeValue","previousContainer","previousSibling","setStart","bubbleNode","previousBubble","parentNode","removeChild","hasChildNodes","lastNode","isEqualNode","pasteString","data","anchor","surroundContents","replaceChild","clipboardData","getData","items","Array","slice","item","kind","type","some","getAsString"],"mappings":"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","file":"x-bubbles.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"x-bubbles\"] = factory();\n\telse\n\t\troot[\"x-bubbles\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"x-bubbles\"] = factory();\n\telse\n\t\troot[\"x-bubbles\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar bubble = __webpack_require__(1);\n\tvar events = __webpack_require__(3);\n\tvar cursor = __webpack_require__(5);\n\t\n\tvar XBubbles = Object.create(HTMLElement.prototype, {\n\t    createdCallback: {\n\t        value: function value() {\n\t            this.setAttribute('contenteditable', 'true');\n\t            this.setAttribute('spellcheck', 'false');\n\t        }\n\t    },\n\t\n\t    attachedCallback: {\n\t        value: function value() {\n\t            this.addEventListener('keydown', onKeydown);\n\t            this.addEventListener('keypress', onKeypress);\n\t            this.addEventListener('paste', onPaste);\n\t            this.addEventListener('drop', onDrop);\n\t            this.addEventListener('blur', onBlur);\n\t            this.addEventListener('focus', onFocus);\n\t        }\n\t    },\n\t\n\t    detachedCallback: {\n\t        value: function value() {\n\t            this.removeEventListener('keydown', onKeydown);\n\t            this.removeEventListener('keypress', onKeypress);\n\t            this.removeEventListener('paste', onPaste);\n\t            this.removeEventListener('drop', onDrop);\n\t            this.removeEventListener('blur', onBlur);\n\t            this.removeEventListener('focus', onFocus);\n\t        }\n\t    },\n\t\n\t    attributeChangedCallback: {\n\t        value: function value() {} // name, previousValue, value\n\t    }\n\t});\n\t\n\tmodule.exports = document.registerElement('x-bubbles', {\n\t    extends: 'div',\n\t    prototype: XBubbles\n\t});\n\t\n\tfunction onKeydown(event) {\n\t    var set = event.currentTarget;\n\t    var code = event.charCode || event.keyCode;\n\t\n\t    // Backspace\n\t    if (code === 8) {\n\t        event.preventDefault();\n\t        events.backSpace(event);\n\t    }\n\t\n\t    // Tab\n\t    if (code === 9) {\n\t        if (bubble.isBubbleNode(event.target)) {\n\t            event.preventDefault();\n\t            set.focus();\n\t        }\n\t    }\n\t\n\t    // Left\n\t    // if (code === 37) {}\n\t\n\t    // Right\n\t    // if (code === 39) {}\n\t\n\t\n\t    // console.log(event.keyCode);\n\t}\n\t\n\tfunction onKeypress(event) {\n\t    var set = event.currentTarget;\n\t    var code = event.charCode || event.keyCode;\n\t\n\t    // Enter || , || ;\n\t    if (code === 13 || code === 44 || code === 59) {\n\t        event.preventDefault();\n\t        bubble.bubbling(set);\n\t        cursor.restore(set);\n\t    }\n\t}\n\t\n\tfunction onDrop(event) {\n\t    event.preventDefault();\n\t    // var data = event.dataTransfer.getData('text/plain');\n\t}\n\t\n\tfunction onPaste(event) {\n\t    event.preventDefault();\n\t    events.paste(event);\n\t}\n\t\n\tfunction onBlur(event) {\n\t    bubble.bubbling(event.currentTarget);\n\t}\n\t\n\tfunction onFocus(event) {\n\t    cursor.restore(event.currentTarget);\n\t}\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\t\n\tvar zws = __webpack_require__(2);\n\t\n\tvar REG_SEPARATOR = /[,]/;\n\tvar REG_ENDING = null; // /\\@ya\\.ru/g;\n\tvar REG_BEGINING = null;\n\tvar NOOP = function NOOP() {};\n\t\n\texports.isBubbleNode = isBubbleNode;\n\texports.bubbling = bubbling;\n\t\n\tfunction isBubbleNode(node) {\n\t    return node && node.nodeType === Node.ELEMENT_NODE && node.classList.contains('bubble');\n\t}\n\t\n\tfunction bubbling(set, options) {\n\t    options = _extends({\n\t        begining: REG_BEGINING,\n\t        ending: REG_ENDING,\n\t        separator: REG_SEPARATOR,\n\t        onBubble: NOOP\n\t    }, options);\n\t\n\t    var ranges = getBubbleRanges(set);\n\t    var nodes = [];\n\t\n\t    ranges.forEach(function (range) {\n\t        var text = zws.textClean(range.toString()).trim();\n\t\n\t        if (!text) {\n\t            range.deleteContents();\n\t            return;\n\t        }\n\t\n\t        var textParts = [text];\n\t\n\t        if (options.separator) {\n\t            textParts = text.split(options.separator).map(trimIterator).filter(nonEmptyIterator);\n\t        }\n\t\n\t        if (options.ending) {\n\t            textParts = textParts.reduce(function (parts, str) {\n\t                return parts.concat(parseFragmentByEnding(str, options.ending));\n\t            }, []).map(trimIterator).filter(nonEmptyIterator);\n\t        } else if (options.begining) {\n\t            textParts = textParts.reduce(function (parts, str) {\n\t                return parts.concat(parseFragmentByBeginning(str, options.begining));\n\t            }, []).map(trimIterator).filter(nonEmptyIterator);\n\t        }\n\t\n\t        if (!textParts.length) {\n\t            range.deleteContents();\n\t        }\n\t\n\t        var fragment = document.createDocumentFragment();\n\t\n\t        textParts.forEach(function (textPart) {\n\t            var wrap = document.createElement('span');\n\t            wrap.innerText = textPart;\n\t            options.onBubble(wrap);\n\t\n\t            wrap.classList.add('bubble');\n\t            wrap.setAttribute('contenteditable', 'false');\n\t            wrap.setAttribute('tabindex', '-1');\n\t\n\t            fragment.appendChild(wrap);\n\t            nodes.push(wrap);\n\t        });\n\t\n\t        range.deleteContents();\n\t        range.insertNode(fragment);\n\t    });\n\t\n\t    return nodes;\n\t}\n\t\n\tfunction getBubbleRanges(set) {\n\t    var i = void 0;\n\t    var rng = void 0;\n\t    var node = void 0;\n\t    var ranges = [];\n\t    var children = set.childNodes;\n\t\n\t    for (i = 0; i < children.length; i++) {\n\t        node = children[i];\n\t\n\t        if (isBubbleNode(node)) {\n\t            if (rng) {\n\t                rng.setEndBefore(node);\n\t                ranges.push(rng);\n\t                rng = undefined;\n\t            }\n\t        } else {\n\t            if (!rng) {\n\t                rng = document.createRange();\n\t                rng.setStartBefore(node);\n\t            }\n\t        }\n\t    }\n\t\n\t    if (rng) {\n\t        rng.setEndAfter(node);\n\t        ranges.push(rng);\n\t    }\n\t\n\t    return ranges;\n\t}\n\t\n\tfunction trimIterator(str) {\n\t    return str.trim();\n\t}\n\t\n\tfunction nonEmptyIterator(str) {\n\t    return Boolean(str);\n\t}\n\t\n\tfunction parseFragmentByEnding(str, reg) {\n\t    var parts = [];\n\t    var lastIndex = 0;\n\t    var loop = 999;\n\t\n\t    reg.lastIndex = 0;\n\t    while (reg.exec(str) !== null && loop) {\n\t        loop--;\n\t        parts.push(str.substring(lastIndex, reg.lastIndex));\n\t        lastIndex = reg.lastIndex;\n\t    }\n\t\n\t    return parts;\n\t}\n\t\n\tfunction parseFragmentByBeginning(str, reg) {\n\t    var parts = [];\n\t    var res = void 0;\n\t    var index = 0;\n\t    var loop = 999;\n\t\n\t    reg.lastIndex = 0;\n\t    while ((res = reg.exec(str)) !== null && loop) {\n\t        loop--;\n\t        if (index !== res.index) {\n\t            parts.push(str.substring(index, res.index));\n\t            index = res.index;\n\t        }\n\t    }\n\t\n\t    parts.push(str.substring(index, str.length));\n\t    return parts;\n\t}\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\t/* eslint-disable max-len */\n\tvar REG_REPLACE_NON_PRINTABLE = /[\\0-\\x1F\\x7F-\\x9F\\xAD\\u0378\\u0379\\u037F-\\u0383\\u038B\\u038D\\u03A2\\u0528-\\u0530\\u0557\\u0558\\u0560\\u0588\\u058B-\\u058E\\u0590\\u05C8-\\u05CF\\u05EB-\\u05EF\\u05F5-\\u0605\\u061C\\u061D\\u06DD\\u070E\\u070F\\u074B\\u074C\\u07B2-\\u07BF\\u07FB-\\u07FF\\u082E\\u082F\\u083F\\u085C\\u085D\\u085F-\\u089F\\u08A1\\u08AD-\\u08E3\\u08FF\\u0978\\u0980\\u0984\\u098D\\u098E\\u0991\\u0992\\u09A9\\u09B1\\u09B3-\\u09B5\\u09BA\\u09BB\\u09C5\\u09C6\\u09C9\\u09CA\\u09CF-\\u09D6\\u09D8-\\u09DB\\u09DE\\u09E4\\u09E5\\u09FC-\\u0A00\\u0A04\\u0A0B-\\u0A0E\\u0A11\\u0A12\\u0A29\\u0A31\\u0A34\\u0A37\\u0A3A\\u0A3B\\u0A3D\\u0A43-\\u0A46\\u0A49\\u0A4A\\u0A4E-\\u0A50\\u0A52-\\u0A58\\u0A5D\\u0A5F-\\u0A65\\u0A76-\\u0A80\\u0A84\\u0A8E\\u0A92\\u0AA9\\u0AB1\\u0AB4\\u0ABA\\u0ABB\\u0AC6\\u0ACA\\u0ACE\\u0ACF\\u0AD1-\\u0ADF\\u0AE4\\u0AE5\\u0AF2-\\u0B00\\u0B04\\u0B0D\\u0B0E\\u0B11\\u0B12\\u0B29\\u0B31\\u0B34\\u0B3A\\u0B3B\\u0B45\\u0B46\\u0B49\\u0B4A\\u0B4E-\\u0B55\\u0B58-\\u0B5B\\u0B5E\\u0B64\\u0B65\\u0B78-\\u0B81\\u0B84\\u0B8B-\\u0B8D\\u0B91\\u0B96-\\u0B98\\u0B9B\\u0B9D\\u0BA0-\\u0BA2\\u0BA5-\\u0BA7\\u0BAB-\\u0BAD\\u0BBA-\\u0BBD\\u0BC3-\\u0BC5\\u0BC9\\u0BCE\\u0BCF\\u0BD1-\\u0BD6\\u0BD8-\\u0BE5\\u0BFB-\\u0C00\\u0C04\\u0C0D\\u0C11\\u0C29\\u0C34\\u0C3A-\\u0C3C\\u0C45\\u0C49\\u0C4E-\\u0C54\\u0C57\\u0C5A-\\u0C5F\\u0C64\\u0C65\\u0C70-\\u0C77\\u0C80\\u0C81\\u0C84\\u0C8D\\u0C91\\u0CA9\\u0CB4\\u0CBA\\u0CBB\\u0CC5\\u0CC9\\u0CCE-\\u0CD4\\u0CD7-\\u0CDD\\u0CDF\\u0CE4\\u0CE5\\u0CF0\\u0CF3-\\u0D01\\u0D04\\u0D0D\\u0D11\\u0D3B\\u0D3C\\u0D45\\u0D49\\u0D4F-\\u0D56\\u0D58-\\u0D5F\\u0D64\\u0D65\\u0D76-\\u0D78\\u0D80\\u0D81\\u0D84\\u0D97-\\u0D99\\u0DB2\\u0DBC\\u0DBE\\u0DBF\\u0DC7-\\u0DC9\\u0DCB-\\u0DCE\\u0DD5\\u0DD7\\u0DE0-\\u0DF1\\u0DF5-\\u0E00\\u0E3B-\\u0E3E\\u0E5C-\\u0E80\\u0E83\\u0E85\\u0E86\\u0E89\\u0E8B\\u0E8C\\u0E8E-\\u0E93\\u0E98\\u0EA0\\u0EA4\\u0EA6\\u0EA8\\u0EA9\\u0EAC\\u0EBA\\u0EBE\\u0EBF\\u0EC5\\u0EC7\\u0ECE\\u0ECF\\u0EDA\\u0EDB\\u0EE0-\\u0EFF\\u0F48\\u0F6D-\\u0F70\\u0F98\\u0FBD\\u0FCD\\u0FDB-\\u0FFF\\u10C6\\u10C8-\\u10CC\\u10CE\\u10CF\\u1249\\u124E\\u124F\\u1257\\u1259\\u125E\\u125F\\u1289\\u128E\\u128F\\u12B1\\u12B6\\u12B7\\u12BF\\u12C1\\u12C6\\u12C7\\u12D7\\u1311\\u1316\\u1317\\u135B\\u135C\\u137D-\\u137F\\u139A-\\u139F\\u13F5-\\u13FF\\u169D-\\u169F\\u16F1-\\u16FF\\u170D\\u1715-\\u171F\\u1737-\\u173F\\u1754-\\u175F\\u176D\\u1771\\u1774-\\u177F\\u17DE\\u17DF\\u17EA-\\u17EF\\u17FA-\\u17FF\\u180F\\u181A-\\u181F\\u1878-\\u187F\\u18AB-\\u18AF\\u18F6-\\u18FF\\u191D-\\u191F\\u192C-\\u192F\\u193C-\\u193F\\u1941-\\u1943\\u196E\\u196F\\u1975-\\u197F\\u19AC-\\u19AF\\u19CA-\\u19CF\\u19DB-\\u19DD\\u1A1C\\u1A1D\\u1A5F\\u1A7D\\u1A7E\\u1A8A-\\u1A8F\\u1A9A-\\u1A9F\\u1AAE-\\u1AFF\\u1B4C-\\u1B4F\\u1B7D-\\u1B7F\\u1BF4-\\u1BFB\\u1C38-\\u1C3A\\u1C4A-\\u1C4C\\u1C80-\\u1CBF\\u1CC8-\\u1CCF\\u1CF7-\\u1CFF\\u1DE7-\\u1DFB\\u1F16\\u1F17\\u1F1E\\u1F1F\\u1F46\\u1F47\\u1F4E\\u1F4F\\u1F58\\u1F5A\\u1F5C\\u1F5E\\u1F7E\\u1F7F\\u1FB5\\u1FC5\\u1FD4\\u1FD5\\u1FDC\\u1FF0\\u1FF1\\u1FF5\\u1FFF\\u200B-\\u200F\\u202A-\\u202E\\u2060-\\u206F\\u2072\\u2073\\u208F\\u209D-\\u209F\\u20BB-\\u20CF\\u20F1-\\u20FF\\u218A-\\u218F\\u23F4-\\u23FF\\u2427-\\u243F\\u244B-\\u245F\\u2700\\u2B4D-\\u2B4F\\u2B5A-\\u2BFF\\u2C2F\\u2C5F\\u2CF4-\\u2CF8\\u2D26\\u2D28-\\u2D2C\\u2D2E\\u2D2F\\u2D68-\\u2D6E\\u2D71-\\u2D7E\\u2D97-\\u2D9F\\u2DA7\\u2DAF\\u2DB7\\u2DBF\\u2DC7\\u2DCF\\u2DD7\\u2DDF\\u2E3C-\\u2E7F\\u2E9A\\u2EF4-\\u2EFF\\u2FD6-\\u2FEF\\u2FFC-\\u2FFF\\u3040\\u3097\\u3098\\u3100-\\u3104\\u312E-\\u3130\\u318F\\u31BB-\\u31BF\\u31E4-\\u31EF\\u321F\\u32FF\\u4DB6-\\u4DBF\\u9FCD-\\u9FFF\\uA48D-\\uA48F\\uA4C7-\\uA4CF\\uA62C-\\uA63F\\uA698-\\uA69E\\uA6F8-\\uA6FF\\uA78F\\uA794-\\uA79F\\uA7AB-\\uA7F7\\uA82C-\\uA82F\\uA83A-\\uA83F\\uA878-\\uA87F\\uA8C5-\\uA8CD\\uA8DA-\\uA8DF\\uA8FC-\\uA8FF\\uA954-\\uA95E\\uA97D-\\uA97F\\uA9CE\\uA9DA-\\uA9DD\\uA9E0-\\uA9FF\\uAA37-\\uAA3F\\uAA4E\\uAA4F\\uAA5A\\uAA5B\\uAA7C-\\uAA7F\\uAAC3-\\uAADA\\uAAF7-\\uAB00\\uAB07\\uAB08\\uAB0F\\uAB10\\uAB17-\\uAB1F\\uAB27\\uAB2F-\\uABBF\\uABEE\\uABEF\\uABFA-\\uABFF\\uD7A4-\\uD7AF\\uD7C7-\\uD7CA\\uD7FC-\\uF8FF\\uFA6E\\uFA6F\\uFADA-\\uFAFF\\uFB07-\\uFB12\\uFB18-\\uFB1C\\uFB37\\uFB3D\\uFB3F\\uFB42\\uFB45\\uFBC2-\\uFBD2\\uFD40-\\uFD4F\\uFD90\\uFD91\\uFDC8-\\uFDEF\\uFDFE\\uFDFF\\uFE1A-\\uFE1F\\uFE27-\\uFE2F\\uFE53\\uFE67\\uFE6C-\\uFE6F\\uFE75\\uFEFD-\\uFF00\\uFFBF-\\uFFC1\\uFFC8\\uFFC9\\uFFD0\\uFFD1\\uFFD8\\uFFD9\\uFFDD-\\uFFDF\\uFFE7\\uFFEF-\\uFFFB\\uFFFE\\uFFFF]/g;\n\tvar REG_ZWS = /\\u200B/;\n\tvar TEXT_ZWS = '​';\n\t\n\texports.textClean = function (text) {\n\t    return String(text).replace(REG_REPLACE_NON_PRINTABLE, '');\n\t};\n\t\n\texports.check = function (text) {\n\t    return REG_ZWS.test(text);\n\t};\n\t\n\texports.createElement = function () {\n\t    return document.createTextNode(TEXT_ZWS);\n\t};\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\texports.backSpace = __webpack_require__(4);\n\texports.paste = __webpack_require__(6);\n\n/***/ },\n/* 4 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar bubble = __webpack_require__(1);\n\tvar cursor = __webpack_require__(5);\n\tvar zws = __webpack_require__(2);\n\t\n\tmodule.exports = function (event) {\n\t    var set = event.currentTarget;\n\t    var bubbleNode = event.target;\n\t\n\t    if (bubble.isBubbleNode(bubbleNode)) {\n\t        var previousBubble = bubbleNode.previousSibling;\n\t        bubbleNode.parentNode.removeChild(bubbleNode);\n\t\n\t        if (bubble.isBubbleNode(previousBubble)) {\n\t            previousBubble.focus();\n\t        } else {\n\t            set.focus();\n\t            cursor.restore(set);\n\t        }\n\t    } else {\n\t        backSpace(set);\n\t    }\n\t};\n\t\n\tfunction backSpace(node) {\n\t    var sel = window.getSelection();\n\t    if (!sel) {\n\t        return;\n\t    }\n\t\n\t    var range = void 0;\n\t\n\t    if (sel.isCollapsed && sel.rangeCount) {\n\t        range = setStartOffset(sel.getRangeAt(0), node);\n\t        sel.removeAllRanges();\n\t        sel.addRange(range);\n\t    }\n\t\n\t    var startRange = sel.rangeCount && sel.getRangeAt(0);\n\t    var startContainer = startRange && startRange.startContainer;\n\t    if (startContainer === node) {\n\t        startContainer = startContainer.childNodes[startRange.startOffset - 1];\n\t    }\n\t\n\t    if (sel.isCollapsed) {\n\t        if (bubble.isBubbleNode(startContainer)) {\n\t            startContainer.focus();\n\t        }\n\t    } else {\n\t        var text = sel.toString();\n\t        var hasZeroWidthSpace = zws.check(text);\n\t\n\t        if (hasZeroWidthSpace && text.length === 1 && bubble.isBubbleNode(startContainer)) {\n\t            startContainer.focus();\n\t        } else {\n\t            sel.deleteFromDocument();\n\t            if (hasZeroWidthSpace && sel.rangeCount && sel.isCollapsed) {\n\t                var fakeText = zws.createElement();\n\t                range = sel.getRangeAt(0);\n\t\n\t                range.deleteContents();\n\t                range.insertNode(fakeText);\n\t                sel.removeAllRanges();\n\t                sel.collapse(fakeText, 1);\n\t            }\n\t        }\n\t    }\n\t}\n\t\n\tfunction setStartOffset(range, node) {\n\t    var startContainer = range.startContainer;\n\t    var startOffset = range.startOffset - 1;\n\t    var setAfter = false;\n\t    var setBefore = false;\n\t\n\t    if (node === startContainer) {\n\t        startContainer = startContainer.childNodes[startOffset - 1];\n\t    }\n\t\n\t    if (bubble.isBubbleNode(startContainer)) {\n\t        range.setStartAfter(startContainer);\n\t        range.setEndAfter(startContainer);\n\t        range.collapse(true);\n\t        return range;\n\t    }\n\t\n\t    if (startOffset >= 0 && startContainer.nodeType === Node.TEXT_NODE && zws.check(startContainer.nodeValue[startOffset])) {\n\t\n\t        startOffset--;\n\t    }\n\t\n\t    while (startOffset < 0) {\n\t        var previousContainer = startContainer.previousSibling;\n\t        if (!previousContainer) {\n\t            setBefore = true;\n\t            break;\n\t        }\n\t\n\t        startContainer = previousContainer;\n\t\n\t        if (bubble.isBubbleNode(startContainer)) {\n\t            setAfter = true;\n\t            break;\n\t        } else if (startContainer.nodeType === Node.TEXT_NODE) {\n\t            startOffset = startContainer.nodeValue.length - 1;\n\t        }\n\t    }\n\t\n\t    if (setAfter) {\n\t        range.setStartAfter(startContainer);\n\t    } else if (setBefore) {\n\t        range.setStartBefore(startContainer);\n\t    } else {\n\t        range.setStart(startContainer, startOffset);\n\t    }\n\t\n\t    return range;\n\t}\n\n/***/ },\n/* 5 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar zws = __webpack_require__(2);\n\t\n\texports.restore = function (node) {\n\t    var fakeText = zws.createElement();\n\t\n\t    if (node.hasChildNodes()) {\n\t        var lastNode = node.childNodes[node.childNodes.length - 1];\n\t\n\t        if (lastNode.isEqualNode(fakeText)) {\n\t            fakeText = lastNode;\n\t        } else {\n\t            node.appendChild(fakeText);\n\t        }\n\t    } else {\n\t        node.appendChild(fakeText);\n\t    }\n\t\n\t    var sel = window.getSelection();\n\t    sel.removeAllRanges();\n\t    sel.collapse(fakeText, 1);\n\t};\n\n/***/ },\n/* 6 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar zws = __webpack_require__(2);\n\t\n\tmodule.exports = function (event) {\n\t    var clipboardData = event.clipboardData;\n\t    if (!clipboardData) {\n\t        return;\n\t    }\n\t\n\t    var data = clipboardData.getData && clipboardData.getData('text/plain');\n\t\n\t    if (!pasteString(data) && clipboardData.items) {\n\t        Array.prototype.slice.call(clipboardData.items).filter(function (item) {\n\t            return item.kind === 'string' && item.type === 'text/plain';\n\t        }).some(function (item) {\n\t            item.getAsString(pasteString);\n\t            return true;\n\t        });\n\t    }\n\t};\n\t\n\tfunction pasteString(data) {\n\t    data = zws.textClean(String(data || '').trim());\n\t    if (!data) {\n\t        return false;\n\t    }\n\t\n\t    var sel = window.getSelection();\n\t    if (!sel || !sel.rangeCount) {\n\t        return;\n\t    }\n\t\n\t    var anchor = document.createElement('span');\n\t    var text = document.createTextNode(data);\n\t\n\t    sel.getRangeAt(0).surroundContents(anchor);\n\t    anchor.parentNode.replaceChild(text, anchor);\n\t    sel.removeAllRanges();\n\t    sel.collapse(text, text.nodeValue.length);\n\t\n\t    return true;\n\t}\n\n/***/ }\n/******/ ])\n});\n;\n\n\n/** WEBPACK FOOTER **\n ** x-bubbles.min.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap d99263f7c13e02004ec3\n **/","const bubble = require('./bubble');\nconst events = require('./events');\nconst cursor = require('./cursor');\n\nconst XBubbles = Object.create(HTMLElement.prototype, {\n    createdCallback: {\n        value: function () {\n            this.setAttribute('contenteditable', 'true');\n            this.setAttribute('spellcheck', 'false');\n        }\n    },\n\n    attachedCallback: {\n        value: function () {\n            this.addEventListener('keydown', onKeydown);\n            this.addEventListener('keypress', onKeypress);\n            this.addEventListener('paste', onPaste);\n            this.addEventListener('drop', onDrop);\n            this.addEventListener('blur', onBlur);\n            this.addEventListener('focus', onFocus);\n        }\n    },\n\n    detachedCallback: {\n        value: function () {\n            this.removeEventListener('keydown', onKeydown);\n            this.removeEventListener('keypress', onKeypress);\n            this.removeEventListener('paste', onPaste);\n            this.removeEventListener('drop', onDrop);\n            this.removeEventListener('blur', onBlur);\n            this.removeEventListener('focus', onFocus);\n        }\n    },\n\n    attributeChangedCallback: {\n        value: function () {} // name, previousValue, value\n    }\n});\n\nmodule.exports = document.registerElement('x-bubbles', {\n    extends: 'div',\n    prototype: XBubbles\n});\n\nfunction onKeydown(event) {\n    const set = event.currentTarget;\n    const code = event.charCode || event.keyCode;\n\n    // Backspace\n    if (code === 8) {\n        event.preventDefault();\n        events.backSpace(event);\n    }\n\n    // Tab\n    if (code === 9) {\n        if (bubble.isBubbleNode(event.target)) {\n            event.preventDefault();\n            set.focus();\n        }\n    }\n\n    // Left\n    // if (code === 37) {}\n\n    // Right\n    // if (code === 39) {}\n\n\n    // console.log(event.keyCode);\n}\n\nfunction onKeypress(event) {\n    const set = event.currentTarget;\n    const code = event.charCode || event.keyCode;\n\n    // Enter || , || ;\n    if (code === 13 || code === 44 || code === 59) {\n        event.preventDefault();\n        bubble.bubbling(set);\n        cursor.restore(set);\n    }\n}\n\nfunction onDrop(event) {\n    event.preventDefault();\n    // var data = event.dataTransfer.getData('text/plain');\n}\n\nfunction onPaste(event) {\n    event.preventDefault();\n    events.paste(event);\n}\n\nfunction onBlur(event) {\n    bubble.bubbling(event.currentTarget);\n}\n\nfunction onFocus(event) {\n    cursor.restore(event.currentTarget);\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./index.js\n **/","const zws = require('./zws');\n\nconst REG_SEPARATOR = /[,]/;\nconst REG_ENDING = null; // /\\@ya\\.ru/g;\nconst REG_BEGINING = null;\nconst NOOP = function () {};\n\nexports.isBubbleNode = isBubbleNode;\nexports.bubbling = bubbling;\n\nfunction isBubbleNode(node) {\n    return node && node.nodeType === Node.ELEMENT_NODE && node.classList.contains('bubble');\n}\n\nfunction bubbling(set, options) {\n    options = {\n        begining: REG_BEGINING,\n        ending: REG_ENDING,\n        separator: REG_SEPARATOR,\n        onBubble: NOOP,\n        ...options\n    };\n\n    const ranges = getBubbleRanges(set);\n    const nodes = [];\n\n    ranges.forEach(function (range) {\n        const text = zws.textClean(range.toString()).trim();\n\n        if (!text) {\n            range.deleteContents();\n            return;\n        }\n\n        let textParts = [ text ];\n\n        if (options.separator) {\n            textParts = text\n                .split(options.separator)\n                .map(trimIterator)\n                .filter(nonEmptyIterator);\n        }\n\n        if (options.ending) {\n            textParts = textParts\n                .reduce((parts, str) => parts.concat(parseFragmentByEnding(str, options.ending)), [])\n                .map(trimIterator)\n                .filter(nonEmptyIterator);\n\n        } else if (options.begining) {\n            textParts = textParts\n                .reduce((parts, str) => parts.concat(parseFragmentByBeginning(str, options.begining)), [])\n                .map(trimIterator)\n                .filter(nonEmptyIterator);\n        }\n\n        if (!textParts.length) {\n            range.deleteContents();\n        }\n\n        const fragment = document.createDocumentFragment();\n\n        textParts.forEach(function (textPart) {\n            const wrap = document.createElement('span');\n            wrap.innerText = textPart;\n            options.onBubble(wrap);\n\n            wrap.classList.add('bubble');\n            wrap.setAttribute('contenteditable', 'false');\n            wrap.setAttribute('tabindex', '-1');\n\n            fragment.appendChild(wrap);\n            nodes.push(wrap);\n        });\n\n        range.deleteContents();\n        range.insertNode(fragment);\n    });\n\n    return nodes;\n}\n\nfunction getBubbleRanges(set) {\n    let i;\n    let rng;\n    let node;\n    const ranges = [];\n    const children = set.childNodes;\n\n    for (i = 0; i < children.length; i++) {\n        node = children[ i ];\n\n        if (isBubbleNode(node)) {\n            if (rng) {\n                rng.setEndBefore(node);\n                ranges.push(rng);\n                rng = undefined;\n            }\n\n        } else {\n            if (!rng) {\n                rng = document.createRange();\n                rng.setStartBefore(node);\n            }\n        }\n    }\n\n    if (rng) {\n        rng.setEndAfter(node);\n        ranges.push(rng);\n    }\n\n    return ranges;\n}\n\nfunction trimIterator(str) {\n    return str.trim();\n}\n\nfunction nonEmptyIterator(str) {\n    return Boolean(str);\n}\n\nfunction parseFragmentByEnding(str, reg) {\n    const parts = [];\n    let lastIndex = 0;\n    let loop = 999;\n\n    reg.lastIndex = 0;\n    while (reg.exec(str) !== null && loop) {\n        loop--;\n        parts.push(str.substring(lastIndex, reg.lastIndex));\n        lastIndex = reg.lastIndex;\n    }\n\n    return parts;\n}\n\nfunction parseFragmentByBeginning(str, reg) {\n    const parts = [];\n    let res;\n    let index = 0;\n    let loop = 999;\n\n    reg.lastIndex = 0;\n    while ((res = reg.exec(str)) !== null && loop) {\n        loop--;\n        if (index !== res.index) {\n            parts.push(str.substring(index, res.index));\n            index = res.index;\n        }\n    }\n\n    parts.push(str.substring(index, str.length));\n    return parts;\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./bubble.js\n **/","/* eslint-disable max-len */\nconst REG_REPLACE_NON_PRINTABLE = /[\\0-\\x1F\\x7F-\\x9F\\xAD\\u0378\\u0379\\u037F-\\u0383\\u038B\\u038D\\u03A2\\u0528-\\u0530\\u0557\\u0558\\u0560\\u0588\\u058B-\\u058E\\u0590\\u05C8-\\u05CF\\u05EB-\\u05EF\\u05F5-\\u0605\\u061C\\u061D\\u06DD\\u070E\\u070F\\u074B\\u074C\\u07B2-\\u07BF\\u07FB-\\u07FF\\u082E\\u082F\\u083F\\u085C\\u085D\\u085F-\\u089F\\u08A1\\u08AD-\\u08E3\\u08FF\\u0978\\u0980\\u0984\\u098D\\u098E\\u0991\\u0992\\u09A9\\u09B1\\u09B3-\\u09B5\\u09BA\\u09BB\\u09C5\\u09C6\\u09C9\\u09CA\\u09CF-\\u09D6\\u09D8-\\u09DB\\u09DE\\u09E4\\u09E5\\u09FC-\\u0A00\\u0A04\\u0A0B-\\u0A0E\\u0A11\\u0A12\\u0A29\\u0A31\\u0A34\\u0A37\\u0A3A\\u0A3B\\u0A3D\\u0A43-\\u0A46\\u0A49\\u0A4A\\u0A4E-\\u0A50\\u0A52-\\u0A58\\u0A5D\\u0A5F-\\u0A65\\u0A76-\\u0A80\\u0A84\\u0A8E\\u0A92\\u0AA9\\u0AB1\\u0AB4\\u0ABA\\u0ABB\\u0AC6\\u0ACA\\u0ACE\\u0ACF\\u0AD1-\\u0ADF\\u0AE4\\u0AE5\\u0AF2-\\u0B00\\u0B04\\u0B0D\\u0B0E\\u0B11\\u0B12\\u0B29\\u0B31\\u0B34\\u0B3A\\u0B3B\\u0B45\\u0B46\\u0B49\\u0B4A\\u0B4E-\\u0B55\\u0B58-\\u0B5B\\u0B5E\\u0B64\\u0B65\\u0B78-\\u0B81\\u0B84\\u0B8B-\\u0B8D\\u0B91\\u0B96-\\u0B98\\u0B9B\\u0B9D\\u0BA0-\\u0BA2\\u0BA5-\\u0BA7\\u0BAB-\\u0BAD\\u0BBA-\\u0BBD\\u0BC3-\\u0BC5\\u0BC9\\u0BCE\\u0BCF\\u0BD1-\\u0BD6\\u0BD8-\\u0BE5\\u0BFB-\\u0C00\\u0C04\\u0C0D\\u0C11\\u0C29\\u0C34\\u0C3A-\\u0C3C\\u0C45\\u0C49\\u0C4E-\\u0C54\\u0C57\\u0C5A-\\u0C5F\\u0C64\\u0C65\\u0C70-\\u0C77\\u0C80\\u0C81\\u0C84\\u0C8D\\u0C91\\u0CA9\\u0CB4\\u0CBA\\u0CBB\\u0CC5\\u0CC9\\u0CCE-\\u0CD4\\u0CD7-\\u0CDD\\u0CDF\\u0CE4\\u0CE5\\u0CF0\\u0CF3-\\u0D01\\u0D04\\u0D0D\\u0D11\\u0D3B\\u0D3C\\u0D45\\u0D49\\u0D4F-\\u0D56\\u0D58-\\u0D5F\\u0D64\\u0D65\\u0D76-\\u0D78\\u0D80\\u0D81\\u0D84\\u0D97-\\u0D99\\u0DB2\\u0DBC\\u0DBE\\u0DBF\\u0DC7-\\u0DC9\\u0DCB-\\u0DCE\\u0DD5\\u0DD7\\u0DE0-\\u0DF1\\u0DF5-\\u0E00\\u0E3B-\\u0E3E\\u0E5C-\\u0E80\\u0E83\\u0E85\\u0E86\\u0E89\\u0E8B\\u0E8C\\u0E8E-\\u0E93\\u0E98\\u0EA0\\u0EA4\\u0EA6\\u0EA8\\u0EA9\\u0EAC\\u0EBA\\u0EBE\\u0EBF\\u0EC5\\u0EC7\\u0ECE\\u0ECF\\u0EDA\\u0EDB\\u0EE0-\\u0EFF\\u0F48\\u0F6D-\\u0F70\\u0F98\\u0FBD\\u0FCD\\u0FDB-\\u0FFF\\u10C6\\u10C8-\\u10CC\\u10CE\\u10CF\\u1249\\u124E\\u124F\\u1257\\u1259\\u125E\\u125F\\u1289\\u128E\\u128F\\u12B1\\u12B6\\u12B7\\u12BF\\u12C1\\u12C6\\u12C7\\u12D7\\u1311\\u1316\\u1317\\u135B\\u135C\\u137D-\\u137F\\u139A-\\u139F\\u13F5-\\u13FF\\u169D-\\u169F\\u16F1-\\u16FF\\u170D\\u1715-\\u171F\\u1737-\\u173F\\u1754-\\u175F\\u176D\\u1771\\u1774-\\u177F\\u17DE\\u17DF\\u17EA-\\u17EF\\u17FA-\\u17FF\\u180F\\u181A-\\u181F\\u1878-\\u187F\\u18AB-\\u18AF\\u18F6-\\u18FF\\u191D-\\u191F\\u192C-\\u192F\\u193C-\\u193F\\u1941-\\u1943\\u196E\\u196F\\u1975-\\u197F\\u19AC-\\u19AF\\u19CA-\\u19CF\\u19DB-\\u19DD\\u1A1C\\u1A1D\\u1A5F\\u1A7D\\u1A7E\\u1A8A-\\u1A8F\\u1A9A-\\u1A9F\\u1AAE-\\u1AFF\\u1B4C-\\u1B4F\\u1B7D-\\u1B7F\\u1BF4-\\u1BFB\\u1C38-\\u1C3A\\u1C4A-\\u1C4C\\u1C80-\\u1CBF\\u1CC8-\\u1CCF\\u1CF7-\\u1CFF\\u1DE7-\\u1DFB\\u1F16\\u1F17\\u1F1E\\u1F1F\\u1F46\\u1F47\\u1F4E\\u1F4F\\u1F58\\u1F5A\\u1F5C\\u1F5E\\u1F7E\\u1F7F\\u1FB5\\u1FC5\\u1FD4\\u1FD5\\u1FDC\\u1FF0\\u1FF1\\u1FF5\\u1FFF\\u200B-\\u200F\\u202A-\\u202E\\u2060-\\u206F\\u2072\\u2073\\u208F\\u209D-\\u209F\\u20BB-\\u20CF\\u20F1-\\u20FF\\u218A-\\u218F\\u23F4-\\u23FF\\u2427-\\u243F\\u244B-\\u245F\\u2700\\u2B4D-\\u2B4F\\u2B5A-\\u2BFF\\u2C2F\\u2C5F\\u2CF4-\\u2CF8\\u2D26\\u2D28-\\u2D2C\\u2D2E\\u2D2F\\u2D68-\\u2D6E\\u2D71-\\u2D7E\\u2D97-\\u2D9F\\u2DA7\\u2DAF\\u2DB7\\u2DBF\\u2DC7\\u2DCF\\u2DD7\\u2DDF\\u2E3C-\\u2E7F\\u2E9A\\u2EF4-\\u2EFF\\u2FD6-\\u2FEF\\u2FFC-\\u2FFF\\u3040\\u3097\\u3098\\u3100-\\u3104\\u312E-\\u3130\\u318F\\u31BB-\\u31BF\\u31E4-\\u31EF\\u321F\\u32FF\\u4DB6-\\u4DBF\\u9FCD-\\u9FFF\\uA48D-\\uA48F\\uA4C7-\\uA4CF\\uA62C-\\uA63F\\uA698-\\uA69E\\uA6F8-\\uA6FF\\uA78F\\uA794-\\uA79F\\uA7AB-\\uA7F7\\uA82C-\\uA82F\\uA83A-\\uA83F\\uA878-\\uA87F\\uA8C5-\\uA8CD\\uA8DA-\\uA8DF\\uA8FC-\\uA8FF\\uA954-\\uA95E\\uA97D-\\uA97F\\uA9CE\\uA9DA-\\uA9DD\\uA9E0-\\uA9FF\\uAA37-\\uAA3F\\uAA4E\\uAA4F\\uAA5A\\uAA5B\\uAA7C-\\uAA7F\\uAAC3-\\uAADA\\uAAF7-\\uAB00\\uAB07\\uAB08\\uAB0F\\uAB10\\uAB17-\\uAB1F\\uAB27\\uAB2F-\\uABBF\\uABEE\\uABEF\\uABFA-\\uABFF\\uD7A4-\\uD7AF\\uD7C7-\\uD7CA\\uD7FC-\\uF8FF\\uFA6E\\uFA6F\\uFADA-\\uFAFF\\uFB07-\\uFB12\\uFB18-\\uFB1C\\uFB37\\uFB3D\\uFB3F\\uFB42\\uFB45\\uFBC2-\\uFBD2\\uFD40-\\uFD4F\\uFD90\\uFD91\\uFDC8-\\uFDEF\\uFDFE\\uFDFF\\uFE1A-\\uFE1F\\uFE27-\\uFE2F\\uFE53\\uFE67\\uFE6C-\\uFE6F\\uFE75\\uFEFD-\\uFF00\\uFFBF-\\uFFC1\\uFFC8\\uFFC9\\uFFD0\\uFFD1\\uFFD8\\uFFD9\\uFFDD-\\uFFDF\\uFFE7\\uFFEF-\\uFFFB\\uFFFE\\uFFFF]/g;\nconst REG_ZWS = /\\u200B/;\nconst TEXT_ZWS = '\\u200B';\n\nexports.textClean = function (text) {\n    return String(text).replace(REG_REPLACE_NON_PRINTABLE, '');\n};\n\nexports.check = function (text) {\n    return REG_ZWS.test(text);\n};\n\nexports.createElement = function () {\n    return document.createTextNode(TEXT_ZWS);\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./zws.js\n **/","\n\nexports.backSpace = require('./events/backSpace');\nexports.paste = require('./events/paste');\n\n\n\n/** WEBPACK FOOTER **\n ** ./events.js\n **/","const bubble = require('../bubble');\nconst cursor = require('../cursor');\nconst zws = require('../zws');\n\nmodule.exports = function (event) {\n    const set = event.currentTarget;\n    const bubbleNode = event.target;\n\n    if (bubble.isBubbleNode(bubbleNode)) {\n        const previousBubble = bubbleNode.previousSibling;\n        bubbleNode.parentNode.removeChild(bubbleNode);\n\n        if (bubble.isBubbleNode(previousBubble)) {\n            previousBubble.focus();\n\n        } else {\n            set.focus();\n            cursor.restore(set);\n        }\n\n    } else {\n        backSpace(set);\n    }\n};\n\nfunction backSpace(node) {\n    const sel = window.getSelection();\n    if (!sel) {\n        return;\n    }\n\n    let range;\n\n    if (sel.isCollapsed && sel.rangeCount) {\n        range = setStartOffset(sel.getRangeAt(0), node);\n        sel.removeAllRanges();\n        sel.addRange(range);\n    }\n\n    const startRange = sel.rangeCount && sel.getRangeAt(0);\n    let startContainer = startRange && startRange.startContainer;\n    if (startContainer === node) {\n        startContainer = startContainer.childNodes[ startRange.startOffset - 1 ];\n    }\n\n    if (sel.isCollapsed) {\n        if (bubble.isBubbleNode(startContainer)) {\n            startContainer.focus();\n        }\n\n    } else {\n        const text = sel.toString();\n        const hasZeroWidthSpace = zws.check(text);\n\n        if (hasZeroWidthSpace && text.length === 1 && bubble.isBubbleNode(startContainer)) {\n            startContainer.focus();\n\n        } else {\n            sel.deleteFromDocument();\n            if (hasZeroWidthSpace && sel.rangeCount && sel.isCollapsed) {\n                const fakeText = zws.createElement();\n                range = sel.getRangeAt(0);\n\n                range.deleteContents();\n                range.insertNode(fakeText);\n                sel.removeAllRanges();\n                sel.collapse(fakeText, 1);\n            }\n        }\n    }\n}\n\nfunction setStartOffset(range, node) {\n    let startContainer = range.startContainer;\n    let startOffset = range.startOffset - 1;\n    let setAfter = false;\n    let setBefore = false;\n\n    if (node === startContainer) {\n        startContainer = startContainer.childNodes[ startOffset - 1 ];\n    }\n\n    if (bubble.isBubbleNode(startContainer)) {\n        range.setStartAfter(startContainer);\n        range.setEndAfter(startContainer);\n        range.collapse(true);\n        return range;\n    }\n\n    if (startOffset >= 0 &&\n        startContainer.nodeType === Node.TEXT_NODE &&\n        zws.check(startContainer.nodeValue[ startOffset ])) {\n\n        startOffset--;\n    }\n\n    while (startOffset < 0) {\n        const previousContainer = startContainer.previousSibling;\n        if (!previousContainer) {\n            setBefore = true;\n            break;\n        }\n\n        startContainer = previousContainer;\n\n        if (bubble.isBubbleNode(startContainer)) {\n            setAfter = true;\n            break;\n\n        } else if (startContainer.nodeType === Node.TEXT_NODE) {\n            startOffset = startContainer.nodeValue.length - 1;\n        }\n    }\n\n    if (setAfter) {\n        range.setStartAfter(startContainer);\n\n    } else if (setBefore) {\n        range.setStartBefore(startContainer);\n\n    } else {\n        range.setStart(startContainer, startOffset);\n    }\n\n    return range;\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./events/backSpace.js\n **/","const zws = require('./zws');\n\nexports.restore = function (node) {\n    let fakeText = zws.createElement();\n\n    if (node.hasChildNodes()) {\n        const lastNode = node.childNodes[ node.childNodes.length - 1 ];\n\n        if (lastNode.isEqualNode(fakeText)) {\n            fakeText = lastNode;\n\n        } else {\n            node.appendChild(fakeText);\n        }\n\n    } else {\n        node.appendChild(fakeText);\n    }\n\n    const sel = window.getSelection();\n    sel.removeAllRanges();\n    sel.collapse(fakeText, 1);\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./cursor.js\n **/","const zws = require('../zws');\n\nmodule.exports = function (event) {\n    const clipboardData = event.clipboardData;\n    if (!clipboardData) {\n        return;\n    }\n\n    let data = clipboardData.getData && clipboardData.getData('text/plain');\n\n    if (!pasteString(data) && clipboardData.items) {\n        Array.prototype.slice.call(clipboardData.items)\n            .filter(item => item.kind === 'string' && item.type === 'text/plain')\n            .some(function (item) {\n                item.getAsString(pasteString);\n                return true;\n            });\n    }\n};\n\nfunction pasteString(data) {\n    data = zws.textClean(String(data || '').trim());\n    if (!data) {\n        return false;\n    }\n\n    const sel = window.getSelection();\n    if (!sel || !sel.rangeCount) {\n        return;\n    }\n\n    const anchor = document.createElement('span');\n    const text = document.createTextNode(data);\n\n    sel.getRangeAt(0).surroundContents(anchor);\n    anchor.parentNode.replaceChild(text, anchor);\n    sel.removeAllRanges();\n    sel.collapse(text, text.nodeValue.length);\n\n    return true;\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./events/paste.js\n **/"],"sourceRoot":""}